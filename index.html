<html>

<!-- ~oh, hi~ -->

<head>
    <title>mootook</title>
    <link rel="stylesheet" href="./assets/index.css">
    <link rel="icon" href="./assets/icons/burst.png">
</head>

<script>
    window.addEventListener('load', onLoad)

    let dx = 0
    let dy = 0
    let startX = 0
    let startY = 0
    let xMax = 0
    let yMax = 0
    let el, elRect
    let eye, eyeRect
    // -1 = none
    // 0 = playing start
    // 1 = done start
    // 2 = playing restore
    // 3 = done restore
    let animState = -1
    let textTimeout
    let plea
    let blinkInterval

    let hasUncovered = false

    function onLoad(win, event) {
        document.getElementById('draggable').addEventListener('mousedown', onBarControlMouseDown)
        document.onmousemove = onMouseMove
        eye = document.getElementById('eye')
        plea = document.getElementById('plea')
        eyeRect = eye.getBoundingClientRect()
    }

    function onBarControlMouseDown(e) {
        startX = e.clientX
        startY = e.clientY
        el = document.getElementById("center-container")
        elRect = el.getBoundingClientRect()
        xMax = document.body.clientWidth - elRect.width
        yMax = document.body.clientHeight - elRect.height
        document.onmouseup = onMouseUp
        e.returnValue = false
    }

    function onMouseUp() {
        el = null
    }

    function onMouseMove(e) {
        if (!el) {
            return;
        }
        dx = startX - e.clientX
        dy = startY - e.clientY
        startX = e.clientX
        startY = e.clientY
        const left = clamp((el.offsetLeft - dx), 0, xMax)
        const top = clamp((el.offsetTop - dy), 0, yMax)
        el.style.left = left + 'px'
        el.style.top = top + 'px'

        const pupilOffsetX = 80
        const pupilOffsetY = 110
        const pupilX = eyeRect.left + pupilOffsetX
        const pupilY = eyeRect.top + pupilOffsetY
        const visibleLeft = left > pupilX
        const visibleRight = left + elRect.width < pupilX
        const visibleTop = top > pupilY
        const visibleBottom = top + elRect.height < pupilY

        if ((visibleLeft || visibleRight || visibleTop || visibleBottom)) {
            if (!hasUncovered) {
                hasUncovered = true
                eye.classList.add("dilate")
                eye.addEventListener('animationstart', onDilateStart)
                eye.addEventListener("animationend", onDilateEnd)

                textTimeout = setTimeout(() => {
                    plea.style.visibility = 'visible'
                    plea.textContent = 'please pick something'
                    textTimeout = setTimeout(() => {
                        plea.textContent = "please."
                        textTimeout = setTimeout(() => {
                            plea.style.visibility = 'hidden'
                        }, 4000)
                    }, 5000)
                }, 8000)
            }
        } else {
            hasUncovered = false
            eye.removeEventListener('animationstart', onDilateStart)
            eye.removeEventListener('animationend', onDilateEnd)
            eye.classList.remove("dilate")
            eye.classList.remove("blink")
            animState = -1

            clearTimeout(textTimeout)
            plea.style.visibility = 'hidden'
            clearInterval(blinkInterval)
        }
    }

    function onDilateStart() {
        if (animState < 2) {
            animState++
        }
    }

    function onDilateEnd() {
        animState++
        if (animState == 3) {
            animState = -1
            eye.removeEventListener('animationstart', onDilateStart)
            eye.removeEventListener('animationend', onDilateEnd)
            eye.classList.remove("dilate")
            startRandomBlink()
        }
    }

    function startRandomBlink() {
        const maxS = 5000
        const minS = 3000
        const randomTime = Math.round(Math.random() * (maxS - minS) + minS)

        // retrigger the animation
        eye.style.animation = 'none'
        eye.offsetHeight
        eye.style.animation = null

        blinkInterval = setTimeout(() => {
            eye.classList.add("blink")
            startRandomBlink()

        }, randomTime)
    }

    function animationIsPlaying() {
        return animState > -1
    }

    function clamp(val, min, max) {
        return Math.min(Math.max(val, min), max)
    }
</script>

<style>
    #eye {
        position: absolute;
        left: calc(50% - var(--home-window-width) / 2);
        top: calc(50% - 100px);
        z-index: 0;
        width: 200px;
        height: 200px;
        background-size: 1200px 200px;
        background-image: url("assets/eye/eye-dilate.png");
    }

    #eye.dilate {
        animation-duration: 0.5s, 1s;
        animation-delay: 0s, 1s;
        animation-name: dilate, dilate;
        animation-timing-function: steps(6, jump-none);
        animation-fill-mode: forwards;
        animation-direction: normal, reverse;
    }

    @keyframes dilate {
        from {
            background-position: 0px 0px;
        }

        to {
            background-position: -1000px 0;
        }
    }


    #eye.blink {
        background-image: url("assets/eye/eye-blink.png");
        background-size: 1000px 200px;
        animation: blink 0.16s linear;
        animation-timing-function: steps(5, jump-none);
    }

    @keyframes blink {
        from {
            background-position: 0 0;
        }

        to {
            background-position: -800px 0;
        }
    }

    #eye>p {
        text-align: center;
        display: flex;
        width: 100%;
        height: 100%;
        flex-direction: column;
        justify-content: end;
    }


    #pupil {
        position: absolute;
        left: calc((50% - var(--home-window-width) / 2) + 75px);
        top: calc((50% - 100px) + 85px);
        z-index: 0;
    }

    td {
        padding: 8px 0 0 0;
    }
</style>

<body>
    <div class="window shadow" id="center-container">
        <div class="window-bar draggable" id="draggable"></div>
        <div class="contents">
            <h1>mootook</h1>
            <hr>
            <table>
                <tr>
                    <td><img class="icon" src="/assets/icons/comp.gray.png" /></td>
                    <td><a href="/work.html">work</a></td>
                </tr>
                <tr>
                    <td><img class="icon" src="/assets/icons/shapes.png" /></td>
                    <td><a href="/projects.html">projects</a></td>
                </tr>
                <tr>
                    <td><img class="icon" src="/assets/icons/quill.png" /></td>
                    <td><a href="mailto:alex@mootook.net">contact</a></td>
                </tr>
            </table>
        </div>
    </div>
    <div id="eye">
        <p id="plea" style="visibility:hidden;"></p>
    </div>
    <div class="footer">
        <a target="_blank" href="https://youtu.be/qxZInIyOBXk?list=RDqxZInIyOBXk">:)</a>
    </div>
</body>

</html>